# =============================================================================
# N8N QUEUE MODE - CONFIGURAÇÃO DE AMBIENTE
# =============================================================================
# Copie este arquivo para .env e configure suas variáveis
# Comando: cp .env.example .env
# =============================================================================

# === CONFIGURAÇÕES BÁSICAS ===
# Seu domínio principal (sem subdomínio)
DOMAIN_NAME=meudominio.com

# Subdomínio para o n8n (resultará em: n8n.meudominio.com)
SUBDOMAIN=n8n

# Timezone para logs e agendamentos
GENERIC_TIMEZONE=America/Sao_Paulo

# === CONFIGURAÇÕES DO BANCO DE DADOS ===
# PostgreSQL - Base de dados principal do n8n
POSTGRES_USER=n8n_user
POSTGRES_PASSWORD=MUDE_ESTA_SENHA_POSTGRES_123
POSTGRES_DB=n8n_database

# === CONFIGURAÇÕES DO N8N ===
# Chave de criptografia (OBRIGATÓRIA) - deve ter pelo menos 10 caracteres
# IMPORTANTE: Não mude após ter dados, ou perderá acesso às credenciais criptografadas
N8N_ENCRYPTION_KEY=chave_super_segura_para_criptografia_n8n_123456789

# Modo de execução (queue para alta escalabilidade)
EXECUTIONS_MODE=queue

# === LIMPEZA AUTOMÁTICA DE DADOS DE EXECUÇÕES ===
# Ativa a limpeza automática de dados de execuções
EXECUTIONS_DATA_PRUNE=true

# Mantém os dados de execuções por no máximo 4320 horas (180 dias)
EXECUTIONS_DATA_MAX_AGE=4320

# Define a frequência em minutos para o processo de "soft delete" para uma vez ao dia
EXECUTIONS_DATA_PRUNE_SOFT_DELETE_INTERVAL=1440

# Define a frequência em minutos para o processo de "hard delete" para uma vez ao dia
EXECUTIONS_DATA_PRUNE_HARD_DELETE_INTERVAL=1440

# === CONFIGURAÇÕES DO REDIS/QUEUE ===
# Redis - Message broker para comunicação entre workers
QUEUE_BULL_REDIS_PASSWORD=MUDE_ESTA_SENHA_REDIS_456

# === CONFIGURAÇÕES DO TRAEFIK ===
# Autenticação básica para dashboard do Traefik
# Formato: usuario:hash_da_senha
# Para gerar: echo "minhasenha" | openssl passwd -apr1 -stdin
# Exemplo abaixo é usuário "admin" com senha "admin"
TRAEFIK_AUTH_USERS=admin:$$apr1$$PfYM2tLR$$KK7agZM61Vp.ynZBqHkuA0

# === CONFIGURAÇÕES CLOUDFLARE (OPCIONAL) ===
# Token API do Cloudflare para atualização automática de DNS
# Obtenha em: https://dash.cloudflare.com/profile/api-tokens
# Permissões necessárias: Zone:Zone:Read, Zone:DNS:Edit
CLOUDFLARE_API_TOKEN=seu_token_cloudflare_aqui

# =============================================================================
# INSTRUÇÕES PARA CONFIGURAÇÃO
# =============================================================================

# 1. ALTERE TODAS AS SENHAS ACIMA - NUNCA use as senhas de exemplo!

# 2. CONFIGURE SEU DOMÍNIO:
#    - Substitua "meudominio.com" pelo seu domínio real
#    - Configure DNS A records apontando para seu IP público:
#      traefik.meudominio.com → SEU_IP_PUBLICO  
#      n8n.meudominio.com → SEU_IP_PUBLICO

# 3. GERE CERTIFICADOS SSL:
#    sudo certbot certonly --standalone -d traefik.meudominio.com
#    sudo certbot certonly --standalone -d n8n.meudominio.com

# 4. CONFIGURE /etc/hosts (WSL E WINDOWS):
#    WSL: echo "IP_DO_WSL traefik.meudominio.com" | sudo tee -a /etc/hosts
#    Windows: Edite C:\Windows\System32\drivers\etc\hosts como Admin

# 5. EXECUTE O SCRIPT DE INICIALIZAÇÃO:
#    ./start.sh

# =============================================================================
# VARIÁVEIS OPCIONAIS/AVANÇADAS
# =============================================================================

# Se você quiser customizar portas ou outras configurações avançadas,
# descomente e modifique as variáveis abaixo:

# N8N_PORT=5678
# N8N_HOST=0.0.0.0
# N8N_PROTOCOL=https
# WEBHOOK_URL=https://n8n.meudominio.com/

# Configurações específicas do PostgreSQL
# DB_POSTGRESDB_HOST=postgres
# DB_POSTGRESDB_PORT=5432

# Configurações específicas do Redis
# QUEUE_BULL_REDIS_HOST=redis
# QUEUE_BULL_REDIS_PORT=6379

# =============================================================================
# EXEMPLO DE SENHAS SEGURAS
# =============================================================================

# Use estes comandos para gerar senhas seguras:

# Para senhas normais:
# openssl rand -base64 32

# Para hash do Traefik (substitua 'suasenha'):
# echo "suasenha" | openssl passwd -apr1 -stdin

# Para chave de criptografia do n8n:
# openssl rand -hex 32

# =============================================================================
# VERIFICAÇÃO DE CONFIGURAÇÃO
# =============================================================================

# Após configurar, verifique se está tudo correto:
# 1. ./start.sh (deve passar em todas as verificações)
# 2. docker-compose config (deve mostrar configuração válida)
# 3. curl -k https://traefik.meudominio.com/api/rawdata (deve retornar JSON)

# =============================================================================
